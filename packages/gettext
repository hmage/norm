#!/bin/bash

fetch_source http://ftpmirror.gnu.org/gettext/gettext-0.26.tar.xz 06caeffe13e4e9f92912e8c4d99d340790f463ae

CONFFLAGS=(
--without-emacs  ## build failure on debian 11 with emacs installed
--disable-java   ## save time on building something that is barely used
--disable-curses ## save time on building something that is barely used

--with-included-libunistring ## need only a small subset of unistring
)

## this fixes build failure
do_unpack
pushd_src
sed -ibak 's/iconv_ostream__flush (iconv_ostream_t stream)$/iconv_ostream__flush (iconv_ostream_t stream, ostream_flush_scope_t scope)/' libtextstyle/lib/iconv-ostream.c
ac_cv_prog_cc_c23=no \
am_cv_func_iconv=yes \
am_cv_func_iconv_works=yes \
CFLAGS="${CFLAGS/-Ofast/}" \
CXXFLAGS="${CXXFLAGS/-Ofast/}" \
LIBS="-liconv $LIBS" \
do_configure "${CONFFLAGS[@]}"
do_make_and_install
popd_src
