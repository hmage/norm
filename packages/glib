#!/bin/bash

depends_on pkg-config
depends_on gettext
depends_on libpcre2 ## modern glib requires pcre2
depends_on libffi
depends_on meson
depends_on ninja
[[ $OSTYPE != *darwin* ]] && depends_on zlib
[[ $OSTYPE == *linux* ]] && depends_on libmount
needs_tool python3 # gdbus-codegen and build scripts

fetch_source https://ftp.gnome.org/pub/gnome/sources/glib/2.86/glib-2.86.4.tar.xz 73681e151396afd4920d33e6677c042b8a53d55c

MESONFLAGS=(
--prefix="$PREFIX"
--buildtype=release
-Ddocumentation=false
-Dman-pages=disabled
-Dtests=false
-Dinstalled_tests=false
-Dselinux=disabled
-Dlibelf=disabled
-Dintrospection=disabled
)

[[ $OSTYPE == *darwin* ]] && MESONFLAGS+=(-Dlibmount=disabled)

do_unpack
BUILDDIR="$SRCDIR"-build
rm -rf "$BUILDDIR"
mkdir -p "$BUILDDIR"
pushd "$BUILDDIR"
meson setup "${MESONFLAGS[@]}" "$SRCDIR"
ninja -j$NUMJOBS
ninja install
popd
