#!/bin/bash

depends_on zlib
depends_on openssl

fetch_source http://http.debian.net/debian/pool/main/o/openssh/openssh_6.7p1.orig.tar.gz 14e5fbed710ade334d65925e080d1aaeb9c85bf6
fetch_debian http://http.debian.net/debian/pool/main/o/openssh/openssh_6.7p1-5.debian.tar.xz c6b2ba45a7b2c00e93c6a47d06a5dcfc2802429f

## this file breaks reinstallation/upgrade
rm -f $PREFIX/share/man/man5/authorized_keys.5

do_undebian
do_compile --with-privsep-path=$PREFIX/var/empty --without-kerberos5 --sysconfdir=$PREFIX/etc/ssh \
           --with-pid-dir=$PREFIX/var/run  --with-mantype=doc --with-ssl-engine \
           --with-ldflags="-Wl,--as-needed $LDFLAGS"

## we disabled kerberos5, so remove the config values as well
sed -i 's/^[^#][ \t]*GSSAPI.*/#&/' $PREFIX/etc/ssh/ssh_config
