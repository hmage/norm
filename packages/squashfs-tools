#!/bin/bash

depends_on xz liblzo
depends_on liblz4
depends_on zstd

[[ $OSTYPE != *darwin* ]] && depends_on zlib ## osx gurantees to provide one, opportunistic linking on other systems

fetch_source https://github.com/plougher/squashfs-tools/archive/refs/tags/4.7.4.tar.gz 7a5a522db815d98673c38f165da0a686720b34f3

do_unpack
SRCDIR="$SRCDIR/squashfs-tools"
pushd_src
do_make XZ_SUPPORT=1 LZO_SUPPORT=1 LZ4_SUPPORT=1 ZSTD_SUPPORT=1 LZMA_XZ_SUPPORT=1 XATTR_SUPPORT=1
cp mksquashfs unsquashfs "$PREFIX/bin/"
ln -fs unsquashfs "$PREFIX/bin/sqfscat"
ln -fs mksquashfs "$PREFIX/bin/sqfstar"
popd_src
