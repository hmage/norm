#!/bin/bash

BOOST_WITHOUT_PYTHON="--without-libraries=python"
if [[ "${BASH_SOURCE[0]##*/}" == libboost-python ]]; then
    depends_on python
    BOOST_WITHOUT_PYTHON="--with-libraries=python --with-python=$ESCAPED_PREFIX/bin/python --with-python-root=$ESCAPED_PREFIX"
fi

fetch_source http://downloads.sourceforge.net/project/boost/boost/1.65.1/boost_1_65_1.tar.bz2 4a5b0c3c1b1b9a4d6cb6a6cc395e903e76f76720

BOOTSTRAP_ARGS=(
--prefix="$PREFIX"
cxxflags="$CPPFLAGS"
linkflags="$LDFLAGS"

)

BOOST_ARGS=(
--prefix="$PREFIX"
cxxflags="$CPPFLAGS"
linkflags="$LDFLAGS"
-d+2
-j$NUMJOBS
link=shared,static

boost.locale.icu=off
-sNO_COMPRESSION=1
--user-config=user-config.jam
)

do_unpack
pushd_src
perl -i.bak -pe 's/.*-fcoalesce-templates.*//g' tools/build/src/tools/darwin.jam ## clang doen't support those anymore
touch user-config.jam
if [[ $OSTYPE == *darwin* ]]; then
    echo "using darwin : : clang++ : <archiver>/usr/bin/libtool ;" >> user-config.jam
fi
set -x
./bootstrap.sh "${BOOTSTRAP_ARGS[@]}" $BOOST_WITHOUT_PYTHON
./b2 "${BOOST_ARGS[@]}"
./b2 "${BOOST_ARGS[@]}" install
set +x
popd_src
