#!/bin/bash

depends_on glib     ## uses gobject-introspection
[[ $OSTYPE != *darwin* ]] && depends_on libexpat ## what for? also on osx it's always there, don't build our own
depends_on meson
depends_on ninja

## image formats
depends_on libpng
depends_on libjpeg
depends_on libheif
depends_on libtiff
depends_on libwebp
depends_on libexif
depends_on libgif

## opportunistic linking
depends_on liblcms2

fetch_source https://github.com/libvips/libvips/releases/download/v8.18.0/vips-8.18.0.tar.xz 380830d3b0f8dde88d0f36da277ab10d2574fcb7

do_unpack
BUILDDIR="$SRCDIR"-build
rm -rf "$BUILDDIR"
mkdir -p "$BUILDDIR"
pushd "$BUILDDIR"
meson setup --prefix="$PREFIX" --buildtype=release "$SRCDIR"
ninja -j$NUMJOBS
ninja install
popd
