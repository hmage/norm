#!/bin/bash

fetch_source https://github.com/LMDB/lmdb/archive/refs/tags/LMDB_0.9.35.tar.gz 07a8d4eb047e291dc6851807ce96b509caf36b76

FLAGS=(prefix="$PREFIX")
[[ $OSTYPE == *darwin* ]] && FLAGS+=(SOEXT=.dylib)

do_unpack
pushd_src
cd libraries/liblmdb
do_make "${FLAGS[@]}"
do_make install "${FLAGS[@]}"

## fix dylib install_name on macOS
if [[ $OSTYPE == *darwin* ]]; then
	install_name_tool -id "$PREFIX/lib/liblmdb.dylib" "$PREFIX/lib/liblmdb.dylib"
fi
popd_src
