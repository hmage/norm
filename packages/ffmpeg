#!/bin/bash

depends_on pkg-config ## otherwise can't find x265
[[ $OSTYPE != *darwin* ]] && depends_on zlib ## opportunistic linking
depends_on xz   ## opportunistic linking
depends_on nasm
depends_on x264
depends_on x265
depends_on libfdk-aac
depends_on libsdl2 ## needed for ffplay to work
[[ $OSTYPE == *linux* ]] && depends_on libasound ## for sound output on linux

fetch_source https://ffmpeg.org/releases/ffmpeg-4.2.1.tar.xz c386b7330259d9eec0bdefb39e05bf9145e3d850

CONFFLAGS=(
--enable-gpl ## needed to use x264 and x265
--enable-nonfree ## needed to use libfdk-aac
--enable-libx264
--enable-libx265
--enable-libfdk-aac ## highest quality AAC encoder available in ffmpeg
--enable-sdl2 ## needed for ffplay
--enable-ffplay ## useful also for analyzing streams
)

do_unpack_compile "${CONFFLAGS[@]}"
