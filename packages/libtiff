#!/bin/bash

depends_on autoconf automake libtool
depends_on xz      ## for xz-compressed tiff's
depends_on libjpeg ## for jpeg-compressed tiff's
depends_on libjbig ## for jbig-compressed tiff's
depends_on zstd    ## for zstd-compressed tiff's

[[ $OSTYPE != *darwin* ]] && depends_on zlib    ## pixar log and zlib in tiff, osx provides the library

fetch_source http://deb.debian.org/debian/pool/main/t/tiff/tiff_4.7.0.orig.tar.bz2 e1a3bd15b0298feecafa4029ea527189732a073f
fetch_debian http://deb.debian.org/debian/pool/main/t/tiff/tiff_4.7.0-3+deb13u1.debian.tar.xz 3c754bfc28bf97a8001205fcc39901153990cf9e

CONFFLAGS=(
--disable-webp ## webp inside tiff is _VERY_ uncommon, and we can't depend on it, because libwebp depends on us!
--without-x    ## opportunistic linking with opengl, a tiff C library doesn't need opengl anyway
)

do_undebian
## fix build failure on C++20
sed -ibak 's|AC_CONFIG_HEADERS(\[config.h|AC_CONFIG_HEADERS([config/config.h|' "$SRCDIR/configure.ac"
do_autoreconf
do_compile "${CONFFLAGS[@]}"
