#!/bin/bash

depends_on pkg-config ## to build .pc file

fetch_source https://github.com/capstone-engine/capstone/archive/5.0.7.tar.gz 5513880163c1f0145fc816e5251a75cb8b8ab0d2

do_unpack
pushd_src
sed -i.bak 's|includedir=$(INCDIR)/capstone|includedir=$(INCDIR)|' Makefile
## fix dylib install_name to use absolute path on macOS
[[ $OSTYPE == *darwin* ]] && sed -i.bak "s|-install_name lib|-install_name $PREFIX/lib/lib|" Makefile
do_make PREFIX="$PREFIX"
do_install PREFIX="$PREFIX"
popd_src
