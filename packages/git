#!/bin/bash

[[ $OSTYPE != *darwin* ]] && depends_on zlib ## osx gurantees to provide one, opportunistic linking on other systems
[[ $OSTYPE != *darwin* ]] && depends_on curl ## for https, but on osx it will use system framework

depends_on libexpat ## opportunistic linking

fetch_source https://www.kernel.org/pub/software/scm/git/git-2.22.0.tar.xz 4984f9f7d32e7f967cee15dce4973c231b2308a1
fetch_file https://www.kernel.org/pub/software/scm/git/git-manpages-2.22.0.tar.xz de406eb992d7a770f20bbec566abc7d82705eb6c

do_unpack
pushd_src
do_auto_configure
do_make_and_install NO_GETTEXT=1 ## if it detects gettext headers, it assumes msgfmt tool is installed, which is not always the case
popd_src

## install bash completion
mkdir -p "$PREFIX/etc/bash_completion.d"
install "$SRCDIR/contrib/completion/git-completion.bash" "$PREFIX/etc/bash_completion.d/git-completion.bash"

## install git manpages
mkdir -p "$PREFIX/share/man"
cat "$CACHEDIR/$FILENAME" | xz -d | tar xf - -C "$PREFIX/share/man"
