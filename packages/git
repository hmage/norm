#!/bin/bash

[[ $OSTYPE != *darwin* ]] && depends_on zlib ## required, osx provides the library
[[ $OSTYPE != *darwin* ]] && depends_on curl ## for git pull over https, osx provides the library

fetch_source https://www.kernel.org/pub/software/scm/git/git-2.39.2.tar.xz 3c415274f626589b37d5b0a9add11de34bcc2f5d
fetch_file https://www.kernel.org/pub/software/scm/git/git-manpages-2.39.2.tar.xz 44b5db090a70c54f6cf39a91ce9c77836c125379

OPTIONS=(
NO_GETTEXT=1 ## if it detects gettext headers, it assumes msgfmt tool is installed, which is not always the case
NO_TCLTK=1   ## build failure if tcl is not installed
V=1          ## verbose logging for easier debugging of user reports
)

do_unpack
pushd_src
do_auto_configure
NEEDV1=1 do_make_and_install "${OPTIONS[@]}"
popd_src

## install bash completion
mkdir -p "$PREFIX/etc/bash_completion.d"
install "$SRCDIR/contrib/completion/git-completion.bash" "$PREFIX/etc/bash_completion.d/git-completion.bash"

## install git manpages
mkdir -p "$PREFIX/share/man"
cat "$CACHEDIR/$FILENAME" | xz -d | tar xf - -C "$PREFIX/share/man"
